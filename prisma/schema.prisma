generator client {
  provider      = "prisma-client"
  output        = "../src/prisma-generated"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
  moduleFormat  = "cjs"
}

datasource db {
  provider = "postgres"
}

model User {
  id           String       @id @default(cuid()) @db.VarChar(36)
  name         String       @db.VarChar(255)
  email        String       @unique @db.VarChar(255)
  phone        String       @db.VarChar(20)
  picture      String       @db.VarChar(255)
  password     String       @db.VarChar(255)
  role         Role
  authProvider AuthProvider
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  favorites    Favorite[]
  provider     Provider?
  requests     Request[]
}

model Provider {
  id          String    @id @db.VarChar(36)
  name        String    @db.VarChar(255)
  description String
  picture     String    @db.VarChar(255)
  address     String    @db.VarChar(300)
  email       String    @db.VarChar(255)
  website     String    @db.VarChar(255)
  phone       String    @db.VarChar(20)
  facebook    String    @db.VarChar(255)
  instagram   String    @db.VarChar(255)
  status      Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  user        User      @relation(fields: [id], references: [id])
  requests    Request[]
  services    Service[]
}

model Category {
  id          String    @id @default(cuid()) @db.VarChar(36)
  name        String    @db.VarChar(255)
  description String
  image       String    @db.VarChar(255)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  services    Service[]
}

model Service {
  id             String          @id @default(cuid()) @db.VarChar(36)
  name           String          @db.VarChar(255)
  description    String
  priceMin       Float
  priceMax       Float
  score          Float
  duration       Int?
  status         Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  providerId     String          @db.VarChar(36)
  categoryId     String          @db.VarChar(36)
  favorites      Favorite[]
  category       Category        @relation(fields: [categoryId], references: [id])
  provider       Provider        @relation(fields: [providerId], references: [id])
  images         ServiceImage[]
  ubigeoServices UbigeoService[]
}

model ServiceImage {
  id        String   @id @default(cuid()) @db.VarChar(36)
  publicId  String   @db.VarChar(255)
  url       String   @db.VarChar(255)
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  serviceId String   @db.VarChar(36)
  service   Service  @relation(fields: [serviceId], references: [id])
}

model Favorite {
  id        String   @id @default(cuid()) @db.VarChar(36)
  createdAt DateTime @default(now())
  userId    String   @db.VarChar(36)
  serviceId String   @db.VarChar(36)
  service   Service  @relation(fields: [serviceId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@unique([userId, serviceId])
}

model Request {
  id           String          @id @default(uuid()) @db.VarChar(36)
  guestQty     Int
  budgetAmount Float
  finalPrice   Float
  eventDate    DateTime
  status       RequestStatus
  comment      String
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  userId       String          @db.VarChar(36)
  providerId   String          @db.VarChar(36)
  provider     Provider        @relation(fields: [providerId], references: [id])
  user         User            @relation(fields: [userId], references: [id])
  items        RequestItem[]
  payment      RequestPayment?
}

model RequestItem {
  id        String  @id @default(uuid()) @db.VarChar(36)
  quantity  Int
  price     Float
  total     Float
  comment   String
  serviceId String  @db.VarChar(36)
  service   Json    @db.Json
  requestId String  @db.VarChar(36)
  request   Request @relation(fields: [requestId], references: [id])
}

model RequestPayment {
  id             String    @id @db.VarChar(36)
  amount         Float
  method         String    @db.VarChar(50)
  image          String    @db.VarChar(255)
  transferNumber String    @db.VarChar(100)
  paidAt         DateTime? @default(now())
  request        Request   @relation(fields: [id], references: [id])
}

model Ubigeo {
  id             String          @id @default(cuid()) @db.VarChar(36)
  code           String          @unique @db.VarChar(6)
  district       String          @db.VarChar(200)
  province       String          @db.VarChar(200)
  department     String          @db.VarChar(200)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  ubigeoServices UbigeoService[]
}

model UbigeoService {
  id        String  @id @default(cuid()) @db.VarChar(36)
  latitude  Float?
  longitude Float?
  serviceId String  @db.VarChar(36)
  ubigeoId  String  @db.VarChar(36)
  service   Service @relation(fields: [serviceId], references: [id])
  ubigeo    Ubigeo  @relation(fields: [ubigeoId], references: [id])

  @@unique([ubigeoId, serviceId])
}

enum Role {
  USER
  ADMIN
}

enum AuthProvider {
  LOCAL
  GOOGLE
  FACEBOOK
}

enum ImageEntityType {
  SERVICE
  PROVIDER
}

enum RequestStatus {
  REQUESTED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}
